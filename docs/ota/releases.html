<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰ˆæœ¬å†å² - PySpOS</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ–¥ï¸</text></svg>">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>PySpOS</h1>
                <span class="version">v3.0.1-pre</span>
            </div>
            <nav>
                <a href="../index.html">é¦–é¡µ</a>
                <a href="index.html">OTA æ›´æ–°</a>
                <a href="releases.html" class="active">ç‰ˆæœ¬å†å²</a>
                <a href="https://github.com/GoutouStdio-cn/PySpOS" target="_blank">GitHub</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="version-info">
            <div class="container">
                <h2 style="text-align: center; margin-bottom: 30px;">ç‰ˆæœ¬å†å²</h2>
                <div id="version-history"></div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 PySpOS. All rights reserved.</p>
            <p>ä½¿ç”¨ Python æ„å»ºçš„æ¨¡æ‹Ÿæ“ä½œç³»ç»Ÿ</p>
        </div>
    </footer>

    <script>
        const fallbackVersionData = {
            "changelog": [
                {
                    "version": "3.0.1-pre",
                    "date": "2026-02-04",
                    "type": "release",
                    "changes": [
                        "æ”¯æŒåœ¨çº¿ OTA æ›´æ–°ã€‚æˆ‘èŠ±äº†å¾ˆä¹…å®ç°äº†è¿™ä¸ªåŠŸèƒ½",
                        "é‡æ„ä¼˜åŒ–äº†éƒ¨åˆ†ä»£ç ",
                        "æ·»åŠ ä¸€ä¸ªçŒå¥‡ç½‘é¡µ"
                    ]
                },
                {
                    "version": "3.0.0",
                    "date": "2026-02-04",
                    "type": "release",
                    "changes": [
                        "å®Œå–„äº†zzlsbçŒœæ•°å­—æ¸¸æˆ",
                        "ä¿®å¤è‹¥å¹²bug",
                        "å®ç°äº†ç®€æ˜“çš„recoveryå’Œæ—¥å¿—å¤„ç†"
                    ]
                }
            ]
        };

        async function loadVersionData() {
            try {
                console.log('å¼€å§‹åŠ è½½ç‰ˆæœ¬æ•°æ®...');
                const response = await fetch('version.json');
                console.log('å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const versionData = await response.json();
                console.log('ç‰ˆæœ¬æ•°æ®åŠ è½½æˆåŠŸ:', versionData);
                renderVersionHistory(versionData);
            } catch (error) {
                console.error('åŠ è½½ç‰ˆæœ¬æ•°æ®å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message);
                console.log('ä½¿ç”¨å¤‡ç”¨æ•°æ®...');
                renderVersionHistory(fallbackVersionData);
            }
        }

        function renderVersionHistory(versionData) {
            const container = document.getElementById('version-history');
            let html = '';

            versionData.changelog.forEach((release, index) => {
                const isNew = index === 0;
                const badgeClass = release.type === 'release' ? 'badge-stable' : 'badge-beta';
                const badgeText = release.type === 'release' ? 'æ­£å¼ç‰ˆ' : 'æµ‹è¯•ç‰ˆ';
                const newBadge = isNew ? '<span class="badge badge-new">NEW</span>' : '';
                const releaseTag = release.version === '3.0.1-pre' ? 'pre_version' : 'beta_version';

                html += `
                    <div class="version-card ${isNew ? 'latest' : ''}">
                        <h3>v${release.version} ${newBadge}</h3>
                        <div class="date">${release.date}</div>
                        <span class="badge ${badgeClass}">${badgeText}</span>
                        <div class="changes">
                            <h4>æ›´æ–°å†…å®¹</h4>
                            <ul>
                                ${release.changes.map(change => `<li>${change}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="download-actions">
                            <a href="https://github.com/GoutouStdio-cn/PySpOS/releases/download/${releaseTag}/PySpOS.zip" 
                               class="btn btn-primary" 
                               style="display: inline-block; margin-right: 10px;">
                                ä¸‹è½½æºä»£ç 
                            </a>
                            <a href="https://github.com/GoutouStdio-cn/PySpOS/releases/tag/${release.version}" 
                               target="_blank" 
                               class="btn btn-secondary"
                               style="display: inline-block;">
                                æŸ¥çœ‹è¯¦æƒ…
                            </a>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        loadVersionData();
    </script>
</body>
</html>