<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰ˆæœ¬å†å² - PySpOS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ–¥ï¸</text></svg>">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>PySpOS</h1>
                <span class="version">v3.0.1-pre</span>
            </div>
            <div class="nav-toggle" id="nav-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <nav class="nav-menu" id="nav-menu">
                <ul>
                    <li><a href="../index.html" class="nav-link">é¦–é¡µ</a></li>
                    <li><a href="index.html" class="nav-link">OTA æ›´æ–°</a></li>
                    <li><a href="releases.html" class="nav-link active">ç‰ˆæœ¬å†å²</a></li>
                    <li><a href="https://github.com/GoutouStdio-cn/PySpOS" target="_blank" class="nav-link">GitHub</a></li>
                </ul>
                <div class="nav-indicator" id="nav-indicator"></div>
            </nav>
        </div>
    </header>

    <main>
        <section class="version-info">
            <div class="container">
                <h2 style="text-align: center; margin-bottom: 30px;">ç‰ˆæœ¬å†å²</h2>
                <div id="version-history"></div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 GoutouStdio. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
            <p>PySpOS æ¨¡æ‹Ÿæ“ä½œç³»ç»ŸåŸºäºPythonå¼€å‘ã€‚</p>
        </div>
    </footer>

    <script>
        // è‹¹æœLiquid Glassæ•ˆæœ - å®æ—¶é¼ æ ‡è·Ÿè¸ªæ¸²æŸ“
        function initLiquidGlassEffect() {
            const cards = document.querySelectorAll('.version-card, .contributor, .feature-card, section, .platform-item, .step-content pre, .changelog-item, .compatibility-list li, .rollback-steps li');
            
            cards.forEach(card => {
                let animationFrame;
                
                const updateMousePosition = (e) => {
                    if (animationFrame) {
                        cancelAnimationFrame(animationFrame);
                    }
                    
                    animationFrame = requestAnimationFrame(() => {
                        const rect = card.getBoundingClientRect();
                        const x = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
                        const y = Math.max(0, Math.min(100, ((e.clientY - rect.top) / rect.height) * 100));
                        
                        card.style.setProperty('--mouse-x', `${x}%`);
                        card.style.setProperty('--mouse-y', `${y}%`);
                    });
                };
                
                card.addEventListener('mousemove', updateMousePosition);
                
                card.addEventListener('mouseenter', (e) => {
                    updateMousePosition(e);
                });
                
                card.addEventListener('mouseleave', () => {
                    if (animationFrame) {
                        cancelAnimationFrame(animationFrame);
                    }
                    card.style.removeProperty('--mouse-x');
                    card.style.removeProperty('--mouse-y');
                });
            });
        }

        const fallbackVersionData = { 
            "changelog": [
                {
                    "version": "3.0.1-pre",
                    "date": "2026-02-04",
                    "type": "beta",
                    "changes": [
                        "æ”¯æŒåœ¨çº¿ OTA æ›´æ–°ã€‚æˆ‘èŠ±äº†å¾ˆä¹…å®ç°äº†è¿™ä¸ªåŠŸèƒ½",
                        "é‡æ„ä¼˜åŒ–äº†éƒ¨åˆ†ä»£ç ",
                        "æ·»åŠ ä¸€ä¸ªçŒå¥‡ç½‘é¡µ"
                    ]
                },
                {
                    "version": "3.0.0",
                    "date": "2026-01-24",
                    "type": "beta",
                    "changes": [
                        "å®Œå–„äº†zzlsbçŒœæ•°å­—æ¸¸æˆ",
                        "ä¿®å¤è‹¥å¹²bug",
                        "å®ç°äº†ç®€æ˜“çš„recoveryå’Œæ—¥å¿—å¤„ç†"
                    ]
                }
            ]
        };

        async function loadVersionData() {
            try {
                console.log('å¼€å§‹åŠ è½½ç‰ˆæœ¬æ•°æ®...');
                const response = await fetch('version.json');
                console.log('å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const versionData = await response.json();
                console.log('ç‰ˆæœ¬æ•°æ®åŠ è½½æˆåŠŸ:', versionData);
                renderVersionHistory(versionData);
            } catch (error) {
                console.error('åŠ è½½ç‰ˆæœ¬æ•°æ®å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message);
                console.log('ä½¿ç”¨å¤‡ç”¨æ•°æ®...');
                renderVersionHistory(fallbackVersionData);
            }
        }

        // ç‰ˆæœ¬å·æ¯”è¾ƒå‡½æ•°
        function compareVersions(version1, version2) {
            // è§£æç‰ˆæœ¬å·ä¸ºæ•°ç»„ï¼Œå¤„ç†é¢„å‘å¸ƒç‰ˆæœ¬
            const parseVersion = (version) => {
                const parts = version.split('-');
                const main = parts[0].split('.').map(Number);
                const prerelease = parts[1] || '';
                return { main, prerelease };
            };

            const v1 = parseVersion(version1);
            const v2 = parseVersion(version2);

            // æ¯”è¾ƒä¸»ç‰ˆæœ¬å·
            for (let i = 0; i < Math.max(v1.main.length, v2.main.length); i++) {
                const num1 = v1.main[i] || 0;
                const num2 = v2.main[i] || 0;
                if (num1 > num2) return 1;
                if (num1 < num2) return -1;
            }

            // ä¸»ç‰ˆæœ¬å·ç›¸åŒï¼Œæ¯”è¾ƒé¢„å‘å¸ƒç‰ˆæœ¬
            if (v1.prerelease && !v2.prerelease) return -1;
            if (!v1.prerelease && v2.prerelease) return 1;
            if (v1.prerelease && v2.prerelease) {
                return v1.prerelease.localeCompare(v2.prerelease);
            }

            return 0;
        }

        // å®æ—¶è·å–æ–‡ä»¶å¤§å°
        async function getFileSize(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                if (response.ok) {
                    const contentLength = response.headers.get('content-length');
                    if (contentLength) {
                        const size = parseInt(contentLength, 10);
                        if (size < 1024) {
                            return `${size} B`;
                        } else if (size < 1024 * 1024) {
                            return `${(size / 1024).toFixed(1)} KB`;
                        } else {
                            return `${(size / (1024 * 1024)).toFixed(1)} MB`;
                        }
                    }
                }
                return 'æœªçŸ¥';
            } catch (error) {
                console.error('è·å–æ–‡ä»¶å¤§å°å¤±è´¥:', error);
                return 'æœªçŸ¥';
            }
        }

        async function renderVersionHistory(versionData) {
            const container = document.getElementById('version-history');
            let html = '<div class="version-cards">';

            // æ‰¾å‡ºæœ€æ–°ç‰ˆæœ¬
            const versions = versionData.changelog.map(release => release.version);
            const latestVersion = versions.reduce((latest, current) => {
                return compareVersions(current, latest) > 0 ? current : latest;
            });

            // è·å–æ–‡ä»¶å¤§å°
            const latestFileSize = await getFileSize('PySpOS.zip');

            versionData.changelog.forEach((release) => {
                const isNew = release.version === latestVersion;
                const badgeClass = release.type === 'release' ? 'badge-stable' : 'badge-beta';
                const badgeText = release.type === 'release' ? 'æ­£å¼ç‰ˆ' : 'æµ‹è¯•ç‰ˆ';
                const newBadge = isNew ? '<span class="badge badge-new">NEW</span>' : '';
                const releaseTag = release.version === '3.0.1-pre' ? 'pre_version' : 'beta_version';
                
                // ä½¿ç”¨å®æ—¶è·å–çš„æ–‡ä»¶å¤§å°
                const fileSize = isNew ? latestFileSize : '64.8 KB';

                html += `
                    <div class="version-card ${isNew ? 'latest' : ''}">
                        <h3>v${release.version} ${newBadge} <span class="badge ${badgeClass}">${badgeText}</span></h3>
                        <div class="date">${release.date}</div>
                        <div class="file-size">æ–‡ä»¶å¤§å°: ${fileSize}</div>
                        <div class="changes">
                            <h4>æ›´æ–°å†…å®¹</h4>
                            <ul>
                                ${release.changes.map(change => `<li>${change}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="download-actions">
                            <a href="${isNew ? 'PySpOS.zip' : `https://github.com/GoutouStdio-cn/PySpOS/releases/download/${releaseTag}/PySpOS.zip`}" 
                               class="btn btn-primary">
                                ä¸‹è½½æºä»£ç  <i class="fas fa-download"></i>
                            </a>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
            
            // åˆå§‹åŒ–Liquid Glassæ•ˆæœ
            setTimeout(initLiquidGlassEffect, 100);
        }

        loadVersionData();
    </script>
    
    <script>
        // å¯¼èˆªèœå•åˆ‡æ¢å’ŒæŒ‡ç¤ºå™¨åŠ¨ç”»
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');
            const navIndicator = document.getElementById('nav-indicator');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let isInitialized = false;
            
            // åˆå§‹åŒ–å¯¼èˆªæŒ‡ç¤ºå™¨ä½ç½®
            function initNavIndicator() {
                const activeLink = document.querySelector('.nav-link.active');
                if (activeLink && navIndicator) {
                    const rect = activeLink.getBoundingClientRect();
                    const navRect = navMenu.getBoundingClientRect();
                    const targetWidth = rect.width;
                    const targetLeft = rect.left - navRect.left;
                    
                    // åˆå§‹è®¾ç½®ï¼Œæ— è¿‡æ¸¡æ•ˆæœ
                    navIndicator.style.transition = 'none';
                    navIndicator.style.width = `${targetWidth}px`;
                    navIndicator.style.transform = `translateX(${targetLeft}px)`;
                    navIndicator.offsetHeight;
                    
                    // å¯ç”¨è¿‡æ¸¡æ•ˆæœ
                    navIndicator.style.transition = 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), width 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                    isInitialized = true;
                }
            }
            
            // æ›´æ–°å¯¼èˆªæŒ‡ç¤ºå™¨ä½ç½®
            function updateNavIndicator(target) {
                if (target && navIndicator) {
                    const rect = target.getBoundingClientRect();
                    const navRect = navMenu.getBoundingClientRect();
                    const targetWidth = rect.width;
                    const targetLeft = rect.left - navRect.left;
                    
                    // ç›´æ¥è®¾ç½®åˆ°ç›®æ ‡ä½ç½®ï¼Œä¿æŒè¿‡æ¸¡æ•ˆæœ
                    navIndicator.style.width = `${targetWidth}px`;
                    navIndicator.style.transform = `translateX(${targetLeft}px)`;
                }
            }
            
            // åˆå§‹åŒ–å¯¼èˆªæŒ‡ç¤ºå™¨
            initNavIndicator();
            
            // æ·»åŠ å¯¼èˆªé“¾æ¥æ‚¬åœäº‹ä»¶
            navLinks.forEach(link => {
                link.addEventListener('mouseenter', function() {
                    updateNavIndicator(this);
                });
                
                link.addEventListener('mouseleave', function() {
                    const activeLink = document.querySelector('.nav-link.active');
                    if (activeLink) {
                        updateNavIndicator(activeLink);
                    }
                });
                
                link.addEventListener('click', function(e) {
                    // ç§»é™¤æ‰€æœ‰é“¾æ¥çš„activeç±»
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    // æ·»åŠ å½“å‰é“¾æ¥çš„activeç±»
                    this.classList.add('active');
                    // æ›´æ–°å¯¼èˆªæŒ‡ç¤ºå™¨ä½ç½®
                    updateNavIndicator(this);
                    // å…³é—­ç§»åŠ¨èœå•
                    navMenu.classList.remove('active');
                });
            });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°åˆå§‹åŒ–å¯¼èˆªæŒ‡ç¤ºå™¨
            window.addEventListener('resize', initNavIndicator);
            
            if (navToggle && navMenu) {
                let isMenuOpen = false;
                
                // åˆ‡æ¢èœå•å‡½æ•°
                function toggleMenu(e) {
                    if (e) {
                        e.stopPropagation();
                    }
                    isMenuOpen = !isMenuOpen;
                    if (isMenuOpen) {
                        navMenu.classList.add('active');
                    } else {
                        navMenu.classList.remove('active');
                    }
                }
                
                // å…³é—­èœå•å‡½æ•°
                function closeMenu() {
                    if (isMenuOpen) {
                        isMenuOpen = false;
                        navMenu.classList.remove('active');
                    }
                }
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
                navToggle.addEventListener('click', toggleMenu);
                
                // æ·»åŠ è§¦æ‘¸äº‹ä»¶ç›‘å¬å™¨ï¼Œç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä¹Ÿèƒ½å“åº”
                navToggle.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    toggleMenu(e);
                });
                
                // ç‚¹å‡»èœå•é¡¹åå…³é—­èœå•
                navLinks.forEach(link => {
                    link.addEventListener('click', closeMenu);
                });
                
                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­èœå•
                document.addEventListener('click', function(e) {
                    if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
                        closeMenu();
                    }
                });
                
                // ESCé”®å…³é—­èœå•
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && isMenuOpen) {
                        closeMenu();
                    }
                });
            }
        });
    </script>
</body>
</html>